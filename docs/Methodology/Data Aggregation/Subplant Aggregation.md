---
stoplight-id: subplant_aggregation
---

CEMS reports data at the unit level (which generally represents a combination of boilers and smokestacks), while EIA-923 data is reported at the generator level (which represents the source of electrical generation itself). Sometimes units and generators are related in simple one-to-one relationships (i.e. a single boiler powers a single generator, and emits pollution via a single stack), but in other cases these units and generators can be configured in complex arrangements (such as one-to-many, many-to-one, or many-to-many). These relationships are described in the [EPA’s Power Sector Data Crosswalk](https://www.epa.gov/airmarkets/power-sector-data-crosswalk) and in the EIA-860 Boiler-Generator Association table. Whenever comparing data between CEMS and EIA, such as when identifying which data is missing from CEMS, or when calculating gross-to-net generation conversions, it is important to ensure that we are comparing the same data.

One way to compare data from the two sources would be to aggregate the data to the plant level, which includes all units and generators. However, at the plant level we lose important details about the operation patterns and emissions from each generator at a plant. 

Thus, using a methodology developed as part of the PUDL project, we aggregate the data into “subplants,” which represent distinct, independent groupings of units and generators at a plant. In some cases, a subplant might consist of a single unit and single generator, but in other cases, it might consist of multiple generators and units that are interconnected (such as for combined-cycle generators). 

The PUDL module for identifying subplants uses graph analysis to identify these unique groupings. As explained in [their documentation](https://catalystcoop-pudl.readthedocs.io/en/latest/autoapi/pudl/analysis/epa_crosswalk/index.html):

> In graph analysis terminology, the [Power Sector Data] crosswalk is a list of edges between nodes (combustors and generators) in a bipartite graph. The `networkx` python package provides functions to analyze this edge list and extract disjoint subgraphs (groups of combustors and generators that are connected to each other). These are the distinct power plants. To avoid a name collision with plant_id, we term these collections ‘subplants’, and identify them with a subplant_id that is unique within each plant_id. Subplants are thus identified with the composite key (plant_id, subplant_id).

Because this methodology relies on the power sector data crosswalk to identify these groupings, a subplant_id is only generated for those units/generators that exist in the crosswalk. Because the subplant_id is used as one of the primary keys for crosswalking CEMS and EIA data, the eventual goal is to ensure that the PSDC has complete coverage of all units that report data to CAMD. Currently, units that are missing from the PSDC or generators that do not report data to CAMD are assigned a missing (`NaN`) subplant_id. In the future our goal is to also add subplant_id for generators that do not report to CAMD based on the relationships in the EIA-860 Boiler-Generator Association table (see [this issue](https://github.com/singularity-energy/open-grid-emissions/issues/49) for updates). The use of `NaN` values for subplant_id in certain cases means that whenever performing a pandas groupby function on subplant_id, it is important to specify `dropna=False` so that these values are not dropped from the data.
